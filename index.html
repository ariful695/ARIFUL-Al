<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#0b0f1a">
    <title>AI Studio Pro</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; -webkit-tap-highlight-color: transparent; overscroll-behavior: none; }
        .dark { background: #0b0f1a; color: white; }
        
        /* Glassmorphism UI */
        .glass { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .message-user { background: linear-gradient(135deg, #2563eb, #7c3aed); color: white; border-radius: 20px 20px 4px 20px; }
        .message-ai { background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 20px 20px 20px 4px; }
        
        /* Mobile Specifics */
        @media (max-width: 768px) {
            #sidebar { position: fixed; left: -100%; transition: 0.3s ease-all; z-index: 100; width: 85%; height: 100%; }
            #sidebar.active { left: 0; }
        }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="dark overflow-hidden h-screen flex">

    <aside id="sidebar" class="w-80 border-r border-white/10 flex flex-col glass">
        <div class="p-6">
            <div class="flex items-center gap-3 mb-8">
                <div class="w-10 h-10 bg-blue-600 rounded-xl flex items-center justify-center shadow-lg shadow-blue-500/30">
                    <i class="ph-fill ph-cpu text-white text-xl"></i>
                </div>
                <h1 class="font-extrabold text-xl tracking-tight">STUDIO PRO</h1>
            </div>
            <button onclick="newChat()" class="w-full py-4 bg-white/5 hover:bg-white/10 border border-white/10 rounded-2xl font-bold text-sm transition-all flex items-center justify-center gap-2">
                <i class="ph ph-plus-circle"></i> New Session
            </button>
        </div>
        <div id="history" class="flex-1 overflow-y-auto px-4 space-y-2 no-scrollbar"></div>
    </aside>

    <main class="flex-1 flex flex-col relative">
        <header class="h-20 flex items-center px-6 border-b border-white/5 glass sticky top-0 z-50">
            <button onclick="toggleSidebar()" class="md:hidden p-3 mr-4 bg-white/5 rounded-xl"><i class="ph ph-list-bold"></i></button>
            <div class="flex-1">
                <div class="flex items-center gap-2">
                    <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                    <span id="status-text" class="text-[10px] font-black uppercase tracking-widest text-white/40">Gemini 2.0 Active</span>
                </div>
                <h2 id="chat-title" class="font-bold text-sm truncate opacity-90">Universal AI Assistant</h2>
            </div>
        </header>

        <div id="chat-box" class="flex-1 overflow-y-auto p-6 space-y-6 md:px-24 lg:px-48 no-scrollbar"></div>

        <footer class="p-6 md:px-24 lg:px-48 glass border-t border-white/5">
            <div class="max-w-4xl mx-auto flex items-end gap-3 bg-white/5 p-2 rounded-[30px] border border-white/10 focus-within:border-blue-500 transition-all">
                <textarea id="user-input" rows="1" placeholder="Ask anything..." class="flex-1 p-4 bg-transparent outline-none resize-none text-sm font-medium text-white"></textarea>
                <button onclick="sendMsg()" class="p-4 bg-blue-600 text-white rounded-full shadow-xl shadow-blue-500/20 hover:scale-105 active:scale-95 transition-all">
                    <i class="ph-bold ph-paper-plane-right"></i>
                </button>
            </div>
        </footer>
    </main>

    <script>
        const KEYS = {
            GEMINI: "AIzaSyBW_krs1ja_ytCy9BqTOc1OOYCB51ywYLU",
            ROUTER: "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"
        };

        const MODEL_CHAIN = [
            { id: "google/gemini-2.0-flash-exp:free", label: "Gemini 2.0", type: "google" },
            { id: "nvidia/nemotron-3-nano-30b-a3b:free", label: "Nemotron-3", type: "router" },
            { id: "meta-llama/llama-3.3-70b-instruct:free", label: "Llama 3.3", type: "router" },
            { id: "openai/gpt-oss-120b:free", label: "GPT-OSS 120B", type: "router" },
            { id: "deepseek/deepseek-r1:free", label: "DeepSeek R1", type: "router" }
        ];

        let state = {
            currentChatId: Date.now(),
            chats: JSON.parse(localStorage.getItem('studio_chats')) || [{ id: Date.now(), title: "First Chat", msgs: [] }]
        };

        function updateStatus(txt) { document.getElementById('status-text').innerText = txt; }

        async function sendMsg() {
            const inp = document.getElementById('user-input');
            const txt = inp.value.trim();
            if(!txt) return;

            const chat = state.chats.find(c => c.id === state.currentChatId);
            chat.msgs.push({ role: 'user', content: txt });
            inp.value = '';
            render();

            chat.msgs.push({ role: 'assistant', content: '...' });
            const aiIdx = chat.msgs.length - 1;
            let success = false;

            for (const model of MODEL_CHAIN) {
                updateStatus(`Linking to ${model.label}...`);
                try {
                    const res = await (model.type === "google" ? callGemini(txt) : callRouter(model.id, chat.msgs));
                    if (res) {
                        chat.msgs[aiIdx].content = res;
                        updateStatus(`${model.label} Online`);
                        success = true; break;
                    }
                } catch (e) { console.warn(`Model ${model.label} failed`); }
            }

            if(!success) chat.msgs[aiIdx].content = "⚠️ Connection Error. All models are busy.";
            save(); render();
        }

        async function callGemini(p) {
            const r = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${KEYS.GEMINI}`, {
                method: "POST", headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ contents: [{ parts: [{ text: p }] }] })
            });
            const d = await r.json();
            return d.candidates[0].content.parts[0].text;
        }

        async function callRouter(m, msgs) {
            const r = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                method: "POST", headers: { "Authorization": `Bearer ${KEYS.ROUTER}`, "Content-Type": "application/json" },
                body: JSON.stringify({ model: m, messages: msgs.slice(0, -1) })
            });
            const d = await r.json();
            return d.choices[0].message.content;
        }

        function render() {
            const box = document.getElementById('chat-box');
            const chat = state.chats.find(c => c.id === state.currentChatId);
            box.innerHTML = chat.msgs.map(m => `
                <div class="flex ${m.role === 'user' ? 'justify-end' : 'justify-start'}">
                    <div class="max-w-[90%] p-4 ${m.role === 'user' ? 'message-user' : 'message-ai'}">
                        <div class="text-[13px] leading-relaxed">${marked.parse(m.content)}</div>
                    </div>
                </div>`).join('');
            box.scrollTop = box.scrollHeight;
            renderHistory();
        }

        function renderHistory() {
            const h = document.getElementById('history');
            h.innerHTML = state.chats.slice().reverse().map(c => `
                <div onclick="state.currentChatId=${c.id};render();" class="p-4 rounded-2xl cursor-pointer ${state.currentChatId === c.id ? 'bg-blue-600/10 text-blue-400' : 'opacity-40'}">
                    <p class="text-[10px] font-bold uppercase truncate">${c.title || 'New Chat'}</p>
                </div>`).join('');
        }

        function toggleSidebar() { document.getElementById('sidebar').classList.toggle('active'); }
        function newChat() { 
            const id = Date.now(); 
            state.chats.push({ id, title: "New Conversation", msgs: [] }); 
            state.currentChatId = id; 
            render(); 
        }
        function save() { localStorage.setItem('studio_chats', JSON.stringify(state.chats)); }
        
        window.onload = render;
    </script>
</body>
</html>

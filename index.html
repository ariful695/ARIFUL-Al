<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI Studio | Gemma-3</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; overscroll-behavior: none; background: #fff; }
        .dark body { background: #0f172a; }
        .user-bubble { background: #2563eb; color: white; border-radius: 1.25rem 1.25rem 0.2rem 1.25rem; }
        .ai-bubble { background: #f1f5f9; border-radius: 1.25rem 1.25rem 1.25rem 0.2rem; }
        .dark .ai-bubble { background: #1e293b; color: #f8fafc; }
        #sidebar { transition: transform 0.3s ease; z-index: 50; width: 280px; }
        @media (max-width: 768px) {
            #sidebar { position: absolute; transform: translateX(-100%); height: 100%; }
            #sidebar.open { transform: translateX(0); box-shadow: 20px 0 50px rgba(0,0,0,0.3); }
        }
    </style>
</head>
<body class="dark:bg-slate-950 text-slate-900 dark:text-slate-100 transition-colors">

    <div id="app-root" class="flex h-screen w-full overflow-hidden">
        <aside id="sidebar" class="bg-slate-50 dark:bg-slate-900 border-r border-slate-200 dark:border-slate-800 flex flex-col">
            <div class="p-6 flex items-center gap-2 text-blue-600">
                <i class="ph-fill ph-google-logo text-2xl"></i>
                <h1 class="font-bold text-lg tracking-tight">Gemma Studio</h1>
            </div>
            <button onclick="createNewChat()" class="mx-4 p-3 bg-blue-600 text-white rounded-xl shadow-lg shadow-blue-500/20 hover:bg-blue-700 transition flex items-center justify-center gap-2 font-bold text-sm">
                <i class="ph ph-plus-bold"></i> New Chat
            </button>
            <div id="chat-history-list" class="flex-1 overflow-y-auto mt-6 px-4 space-y-2"></div>
            <div class="p-4 flex gap-2">
                <button onclick="toggleDarkMode()" class="flex-1 p-3 bg-slate-200 dark:bg-slate-800 rounded-xl flex justify-center"><i id="theme-icon" class="ph ph-moon"></i></button>
            </div>
        </aside>

        <main class="flex-1 flex flex-col min-w-0 bg-white dark:bg-slate-950">
            <header class="h-14 flex items-center px-4 border-b border-slate-100 dark:border-slate-800 backdrop-blur-md z-30">
                <button onclick="toggleSidebar()" class="p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg mr-2"><i class="ph ph-list text-xl"></i></button>
                <div class="flex-1 truncate">
                    <h2 id="current-chat-title" class="font-semibold text-sm truncate">New Conversation</h2>
                    <p class="text-[9px] text-blue-500 font-bold tracking-widest uppercase">Gemma-3-4B Active</p>
                </div>
            </header>

            <div id="messages-display" class="flex-1 overflow-y-auto p-4 space-y-6 md:px-24 lg:px-64 scroll-smooth">
                <div class="text-center py-20 opacity-20">
                    <i class="ph ph-lightning text-6xl"></i>
                    <p class="mt-2 font-bold uppercase tracking-widest text-xs">Waiting for your command</p>
                </div>
            </div>

            <footer class="p-4 md:px-24 lg:px-64 border-t border-slate-100 dark:border-slate-800">
                <div class="max-w-4xl mx-auto flex items-end gap-2 bg-slate-100 dark:bg-slate-900 p-2 rounded-2xl border border-transparent focus-within:border-blue-500 transition-all">
                    <textarea 
                        id="user-input" 
                        rows="1" 
                        placeholder="Ask Gemma anything..." 
                        class="flex-1 p-3 bg-transparent border-none outline-none resize-none text-sm"
                        oninput="this.style.height='auto';this.style.height=this.scrollHeight+'px'"
                        onkeydown="if(event.key==='Enter' && !event.shiftKey){event.preventDefault();sendMessage();}"
                    ></textarea>
                    <button id="send-btn" onclick="sendMessage()" class="p-3 bg-blue-600 text-white rounded-xl hover:scale-105 active:scale-95 transition disabled:opacity-50">
                        <i class="ph-bold ph-paper-plane-right"></i>
                    </button>
                </div>
            </footer>
        </main>
    </div>

    <script>
        // ðŸ”‘ CONFIG
        const OWNER_API_KEY = "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";
        const MODEL_ID = "google/gemma-3-4b-it:free";

        let state = {
            chats: JSON.parse(localStorage.getItem('ai_chats')) || [],
            currentChatId: null,
            isDark: localStorage.getItem('ai_theme') === 'dark',
            isStreaming: false
        };

        window.onload = () => {
            initTheme();
            if (state.chats.length > 0) loadChat(state.chats[0].id);
            else createNewChat();
        };

        async function sendMessage() {
            const input = document.getElementById('user-input');
            const text = input.value.trim();
            if (!text || state.isStreaming) return;

            const chat = state.chats.find(c => c.id === state.currentChatId);
            chat.messages.push({ role: 'user', content: text });
            input.value = '';
            input.style.height = 'auto';
            renderMessages();

            chat.messages.push({ role: 'assistant', content: '...' });
            const aiIdx = chat.messages.length - 1;
            state.isStreaming = true;
            document.getElementById('send-btn').disabled = true;

            try {
                const res = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                    method: "POST",
                    headers: { 
                        "Authorization": `Bearer ${OWNER_API_KEY}`, 
                        "Content-Type": "application/json",
                        "HTTP-Referer": window.location.origin 
                    },
                    body: JSON.stringify({ model: MODEL_ID, messages: chat.messages.slice(0, -1) })
                });

                const data = await res.json();
                
                if (data.error) {
                    chat.messages[aiIdx].content = `âŒ **API Error:** ${data.error.message}`;
                } else {
                    chat.messages[aiIdx].content = data.choices[0].message.content;
                }
            } catch (err) {
                chat.messages[aiIdx].content = "âŒ **Connection Failed:** Check your internet or API key status.";
            } finally {
                state.isStreaming = false;
                document.getElementById('send-btn').disabled = false;
                if (chat.title === "New Conversation") chat.title = text.slice(0, 30);
                save(); renderMessages(); renderChatHistory();
            }
        }

        function renderMessages() {
            const container = document.getElementById('messages-display');
            const chat = state.chats.find(c => c.id === state.currentChatId);
            if (!chat) return;
            container.innerHTML = chat.messages.map(m => `
                <div class="flex ${m.role === 'user' ? 'justify-end' : 'justify-start'}">
                    <div class="max-w-[90%] p-4 ${m.role === 'user' ? 'user-bubble shadow-md' : 'ai-bubble border dark:border-slate-800'}">
                        <div class="prose dark:prose-invert text-sm leading-relaxed">${marked.parse(m.content)}</div>
                    </div>
                </div>
            `).join('');
            container.scrollTop = container.scrollHeight;
        }

        function createNewChat() {
            const id = Date.now().toString();
            state.chats.push({ id, title: "New Conversation", messages: [] });
            loadChat(id);
        }

        function loadChat(id) {
            state.currentChatId = id;
            renderMessages();
            renderChatHistory();
            const curr = state.chats.find(c => c.id === id);
            document.getElementById('current-chat-title').innerText = curr ? curr.title : "Chat";
            if (window.innerWidth < 768) document.getElementById('sidebar').classList.remove('open');
        }

        function renderChatHistory() {
            const list = document.getElementById('chat-history-list');
            list.innerHTML = state.chats.slice().reverse().map(c => `
                <div onclick="loadChat('${c.id}')" class="p-3 text-xs rounded-xl cursor-pointer transition-all truncate ${state.currentChatId === c.id ? 'bg-blue-600/10 text-blue-600 font-bold' : 'hover:bg-slate-200 dark:hover:bg-slate-800 text-slate-500'}">
                    <i class="ph ph-chat-circle mr-2"></i> ${c.title}
                </div>
            `).join('');
        }

        function toggleSidebar() { document.getElementById('sidebar').classList.toggle('open'); }
        function save() { localStorage.setItem('ai_chats', JSON.stringify(state.chats)); }
        function toggleDarkMode() {
            state.isDark = !state.isDark;
            initTheme();
        }
        function initTheme() {
            document.documentElement.classList.toggle('dark', state.isDark);
            document.getElementById('theme-icon').className = state.isDark ? 'ph ph-sun' : 'ph ph-moon';
            localStorage.setItem('ai_theme', state.isDark ? 'dark' : 'light');
        }
    </script>
</body>
    </html>
    

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI Studio Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background: #fff; overscroll-behavior: none; }
        .dark body { background: #0b0f1a; }
        
        /* Message Bubbles */
        .user-bubble { background: #2563eb; color: white; border-radius: 1.25rem 1.25rem 0.2rem 1.25rem; }
        .ai-bubble { background: #f8fafc; border-radius: 1.25rem 1.25rem 1.25rem 0.2rem; border: 1px solid #e2e8f0; }
        .dark .ai-bubble { background: #161b22; color: #f0f6fc; border-color: #30363d; }
        
        /* Desktop Sidebar (Left) */
        #sidebar { transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); z-index: 60; width: 280px; }
        
        /* Mobile Bottom Sheet */
        @media (max-width: 768px) {
            #sidebar { 
                position: fixed; bottom: 0; left: 0; width: 100%; 
                height: 70%; transform: translateY(100%); 
                border-radius: 2rem 2rem 0 0; border-top: 1px solid rgba(0,0,0,0.1);
            }
            #sidebar.open { transform: translateY(0); box-shadow: 0 -20px 50px rgba(0,0,0,0.2); }
            .dark #sidebar { border-top: 1px solid rgba(255,255,255,0.1); }
        }

        /* Bottom Sheet Handle Bar */
        .handle { width: 40px; height: 5px; background: #cbd5e1; border-radius: 10px; margin: 10px auto; display: none; }
        @media (max-width: 768px) { .handle { display: block; } }

        #sidebar-overlay { 
            display: none; position: fixed; inset: 0; 
            background: rgba(0,0,0,0.4); backdrop-filter: blur(4px); z-index: 55; 
        }
        #sidebar-overlay.active { display: block; }

        .img-container { position: relative; margin-top: 10px; border-radius: 12px; overflow: hidden; }
        .download-btn { 
            position: absolute; bottom: 8px; right: 8px; background: rgba(0,0,0,0.8); 
            color: white; padding: 6px 10px; border-radius: 6px; font-size: 10px; font-weight: bold;
        }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="dark:bg-slate-950 text-slate-900 dark:text-slate-100">

    <div id="sidebar-overlay" onclick="toggleSidebar()"></div>

    <div id="app-root" class="flex h-screen w-full overflow-hidden flex-col md:flex-row">
        
        <aside id="sidebar" class="bg-white dark:bg-slate-900 border-r border-slate-200 dark:border-slate-800 flex flex-col">
            <div class="handle"></div>
            <div class="p-6 flex items-center justify-between">
                <div class="flex items-center gap-2 text-blue-600">
                    <i class="ph-fill ph-circles-three-plus text-2xl"></i>
                    <h1 class="font-bold text-lg tracking-tight">AI Studio</h1>
                </div>
                <button onclick="toggleSidebar()" class="p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-full">
                    <i class="ph ph-x-bold"></i>
                </button>
            </div>
            
            <button onclick="createNewChat()" class="mx-6 p-4 bg-blue-600 text-white rounded-2xl shadow-lg hover:bg-blue-700 transition flex items-center justify-center gap-2 font-bold text-sm">
                <i class="ph ph-plus-circle-bold text-lg"></i> Start New Chat
            </button>

            <div id="chat-history-list" class="flex-1 overflow-y-auto mt-6 px-4 space-y-2 no-scrollbar"></div>

            <div class="p-6 border-t dark:border-slate-800 flex gap-3">
                <button onclick="toggleDarkMode()" class="flex-1 p-3 bg-slate-100 dark:bg-slate-800 rounded-xl flex items-center justify-center gap-2 font-bold text-[10px] uppercase">
                    <i id="theme-icon" class="ph ph-moon"></i> Theme
                </button>
            </div>
        </aside>

        <main class="flex-1 flex flex-col min-w-0 bg-white dark:bg-slate-950 relative">
            <header class="h-16 flex items-center px-4 border-b border-slate-100 dark:border-slate-800 sticky top-0 bg-white/80 dark:bg-slate-950/80 backdrop-blur-md z-40">
                <button onclick="toggleSidebar()" class="p-3 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-xl mr-3">
                    <i class="ph ph-text-indent-bold text-xl"></i>
                </button>
                <div class="flex-1">
                    <h2 id="current-chat-title" class="font-bold text-xs uppercase tracking-widest opacity-50">DeepSeek Reasoning</h2>
                </div>
            </header>

            <div id="messages-display" class="flex-1 overflow-y-auto p-4 space-y-6 md:px-24 lg:px-64 scroll-smooth">
                </div>

            <footer class="p-4 md:px-24 lg:px-64 border-t border-slate-100 dark:border-slate-800">
                <div class="max-w-4xl mx-auto space-y-3">
                    <div class="flex gap-2 overflow-x-auto pb-1 no-scrollbar">
                        <button onclick="setStyle('cinematic')" id="btn-cinematic" class="style-btn px-4 py-2 rounded-xl border dark:border-slate-700 text-[10px] font-bold uppercase bg-blue-600 text-white transition-all">Cinematic</button>
                        <button onclick="setStyle('anime')" id="btn-anime" class="style-btn px-4 py-2 rounded-xl border dark:border-slate-700 text-[10px] font-bold uppercase whitespace-nowrap">Anime</button>
                        <button onclick="setStyle('cyberpunk')" id="btn-cyberpunk" class="style-btn px-4 py-2 rounded-xl border dark:border-slate-700 text-[10px] font-bold uppercase whitespace-nowrap">Cyberpunk</button>
                        <button onclick="setStyle('realistic')" id="btn-realistic" class="style-btn px-4 py-2 rounded-xl border dark:border-slate-700 text-[10px] font-bold uppercase whitespace-nowrap">Realistic</button>
                    </div>

                    <div class="flex items-end gap-2 bg-slate-100 dark:bg-slate-900 p-2 rounded-3xl border-2 border-transparent focus-within:border-blue-500 transition-all shadow-sm">
                        <textarea id="user-input" rows="1" placeholder="Write something..." class="flex-1 p-3 bg-transparent border-none outline-none resize-none text-sm font-medium"></textarea>
                        
                        <button onclick="generateImage()" title="Create Art" class="p-4 bg-purple-600 text-white rounded-2xl hover:scale-105 transition shadow-lg shadow-purple-500/30">
                            <i class="ph-bold ph-paint-brush-broad"></i>
                        </button>

                        <button onclick="sendMessage()" class="p-4 bg-blue-600 text-white rounded-2xl hover:scale-105 transition shadow-lg shadow-blue-500/30">
                            <i class="ph-bold ph-paper-plane-right"></i>
                        </button>
                    </div>
                </div>
            </footer>
        </main>
    </div>

    <script>
        const OWNER_API_KEY = "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";
        const CHAT_MODEL = "deepseek/deepseek-r1:free";

        let state = {
            chats: JSON.parse(localStorage.getItem('ai_chats')) || [],
            currentChatId: null,
            isDark: localStorage.getItem('ai_theme') === 'dark',
            currentStyle: 'cinematic'
        };

        window.onload = () => {
            initTheme();
            if (state.chats.length > 0) loadChat(state.chats[0].id);
            else createNewChat();
        };

        function toggleSidebar() {
            const sb = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebar-overlay');
            sb.classList.toggle('open');
            overlay.classList.toggle('active');
        }

        function setStyle(style) {
            state.currentStyle = style;
            document.querySelectorAll('.style-btn').forEach(b => b.classList.remove('bg-blue-600', 'text-white'));
            document.getElementById(`btn-${style}`).classList.add('bg-blue-600', 'text-white');
        }

        async function downloadImg(url) {
            const res = await fetch(url);
            const blob = await res.blob();
            const a = document.createElement("a");
            a.href = URL.createObjectURL(blob);
            a.download = `Studio-Art-${Date.now()}.jpg`;
            a.click();
        }

        async function generateImage() {
            const input = document.getElementById('user-input');
            const p = input.value.trim();
            if(!p) return;

            const chat = state.chats.find(c => c.id === state.currentChatId);
            chat.messages.push({ role: 'user', content: `ðŸ–¼ï¸ [${state.currentStyle}] ${p}` });
            input.value = '';
            renderMessages();

            const url = `https://pollinations.ai/p/${encodeURIComponent(state.currentStyle + " " + p)}?width=1024&height=1024&nologo=true&seed=${Math.random()}`;
            chat.messages.push({ role: 'assistant', type: 'image', url: url });
            save(); renderMessages();
        }

        async function sendMessage() {
            const input = document.getElementById('user-input');
            const txt = input.value.trim();
            if(!txt) return;

            const chat = state.chats.find(c => c.id === state.currentChatId);
            chat.messages.push({ role: 'user', content: txt });
            input.value = '';
            renderMessages();

            chat.messages.push({ role: 'assistant', content: '_Analysing request..._' });
            const aiIdx = chat.messages.length - 1;

            try {
                const res = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                    method: "POST",
                    headers: { "Authorization": `Bearer ${OWNER_API_KEY}`, "Content-Type": "application/json" },
                    body: JSON.stringify({ model: CHAT_MODEL, messages: chat.messages.slice(0, -1) })
                });
                const data = await res.json();
                chat.messages[aiIdx].content = data.choices[0].message.content;
            } catch(e) { chat.messages[aiIdx].content = "Error connecting to DeepSeek."; }
            finally { if(chat.title === "New Conversation") chat.title = txt.slice(0, 15); save(); renderMessages(); renderChatHistory(); }
        }

        function renderMessages() {
            const container = document.getElementById('messages-display');
            const chat = state.chats.find(c => c.id === state.currentChatId);
            if(!chat) return;

            container.innerHTML = chat.messages.map(m => {
                if(m.type === 'image') return `
                    <div class="flex justify-start"><div class="max-w-[90%] md:max-w-[400px] ai-bubble p-2">
                        <div class="img-container">
                            <img src="${m.url}" class="gen-image" />
                            <button onclick="downloadImg('${m.url}')" class="download-btn">DOWNLOAD HD</button>
                        </div>
                    </div></div>`;
                return `
                    <div class="flex ${m.role === 'user' ? 'justify-end' : 'justify-start'}">
                        <div class="max-w-[92%] p-4 ${m.role === 'user' ? 'user-bubble shadow-lg' : 'ai-bubble shadow-sm'}">
                            <div class="prose dark:prose-invert text-[13px] leading-relaxed">${marked.parse(m.content)}</div>
                        </div>
                    </div>`;
            }).join('');
            container.scrollTop = container.scrollHeight;
        }

        function createNewChat() {
            const id = Date.now().toString();
            state.chats.push({ id, title: "New Conversation", messages: [] });
            loadChat(id);
        }

        function loadChat(id) {
            state.currentChatId = id;
            renderMessages();
            renderChatHistory();
            const sb = document.getElementById('sidebar');
            if(sb.classList.contains('open')) toggleSidebar();
        }

        function renderChatHistory() {
            const list = document.getElementById('chat-history-list');
            list.innerHTML = state.chats.slice().reverse().map(c => `
                <div onclick="loadChat('${c.id}')" class="p-4 mx-2 rounded-2xl cursor-pointer text-[11px] font-bold uppercase tracking-widest transition-all ${state.currentChatId === c.id ? 'bg-blue-600/10 text-blue-600' : 'opacity-40'}">
                    <i class="ph ph-chat-circle-text mr-2 text-lg"></i> ${c.title}
                </div>`).join('');
        }

        function toggleDarkMode() { state.isDark = !state.isDark; initTheme(); }
        function initTheme() {
            document.documentElement.classList.toggle('dark', state.isDark);
            document.getElementById('theme-icon').className = state.isDark ? 'ph ph-sun' : 'ph ph-moon';
            localStorage.setItem('ai_theme', state.isDark ? 'dark' : 'light');
        }
        function save() { localStorage.setItem('ai_chats', JSON.stringify(state.chats)); }
    </script>
</body>
                </html>
    
